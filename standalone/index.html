<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>WASM Test for Marching Cubes</title>
</head>
<body>
	<button id="button">Run Test (See console)</button>
	<div id="container"></div>
	<script type="module">

		import Module from './geometry.js';
		import * as THREE from './three.module.js';
		import { OrbitControls } from './OrbitControls.js';
		import { TerrainManager } from './terrain-manager.js';

		let moduleInstance = Module;

		var scene, camera, renderer, width, height;

		var terrainManager = new TerrainManager(200, 2, moduleInstance);

		document.getElementById('button').addEventListener('click', () => {

			terrainManager.init();
			scene.add(terrainManager.mesh);
		});

		width = 1024;
		height = 768;

		scene = new THREE.Scene();
		scene.background = new THREE.Color(0, 1, 0);

		camera = new THREE.PerspectiveCamera(50, width / height, 0.1, 5000);
		camera.position.set(0, 500, 0);

		const dirLight = new THREE.DirectionalLight(0xffffff, 0.5);
		dirLight.position.set(200, 200, 20);

		scene.add(dirLight);


		var container = document.getElementById( 'container' );

		renderer = new THREE.WebGLRenderer({ antialias: true });
		renderer.setPixelRatio( window.devicePixelRatio );
		renderer.setSize(width, height);

		container.appendChild(renderer.domElement);

		renderer.setAnimationLoop(() => {
			// console.log(">>> camera position: ", camera.position);
			terrainManager.updateCenter(camera.position);
			terrainManager.updateChunk();
			renderer.render(scene, camera);
		});

		var box = new THREE.Mesh(
			new THREE.BoxGeometry(1, 1), new THREE.MeshBasicMaterial({ color: 0x0000ff, wireframe: true })
		);
		scene.add(box);

		var controls = new OrbitControls(camera, renderer.domElement);

	</script>
</body>
</html>
